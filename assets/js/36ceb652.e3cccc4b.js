"use strict";(self.webpackChunkdocus=self.webpackChunkdocus||[]).push([[7261],{4291:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"pools/smart-contracts/erc20-collateral-pool-contract/smart-contract-erc20-collateral-pool-technical-aspects","title":"Technical Aspects","description":"Contract Modules","source":"@site/docs/pools/smart-contracts/erc20-collateral-pool-contract/technical_aspects.md","sourceDirName":"pools/smart-contracts/erc20-collateral-pool-contract","slug":"/pools/smart-contracts/erc20-collateral-pool-contract/smart-contract-erc20-collateral-pool-technical-aspects","permalink":"/docs/pools/smart-contracts/erc20-collateral-pool-contract/smart-contract-erc20-collateral-pool-technical-aspects","draft":false,"unlisted":false,"editUrl":"https://github.com/defactor-com/documentation/tree/main/docs/pools/smart-contracts/erc20-collateral-pool-contract/technical_aspects.md","tags":[{"inline":true,"label":"Technical Aspects","permalink":"/docs/tags/technical-aspects"}],"version":"current","sidebarPosition":2,"frontMatter":{"id":"smart-contract-erc20-collateral-pool-technical-aspects","title":"Technical Aspects","sidebar_position":2,"tags":["Technical Aspects"]},"sidebar":"docSidebar","previous":{"title":"Introduction","permalink":"/docs/pools/smart-contracts/erc20-collateral-pool-contract/smart-contract-erc20-collateral-pool"},"next":{"title":"Example","permalink":"/docs/pools/smart-contracts/erc20-collateral-pool-contract/smart-contract-erc20-collateral-pool-example"}}');var o=l(4848),t=l(8453);const s={id:"smart-contract-erc20-collateral-pool-technical-aspects",title:"Technical Aspects",sidebar_position:2,tags:["Technical Aspects"]},c=void 0,r={},a=[{value:"Contract Modules",id:"contract-modules",level:2},{value:"Key Components",id:"key-components",level:2},{value:"Constants",id:"constants",level:3},{value:"Initialization",id:"initialization",level:3},{value:"Pool Management",id:"pool-management",level:3},{value:"Contract Control",id:"contract-control",level:3},{value:"User Interactions",id:"user-interactions",level:3},{value:"Calculation Utilities",id:"calculation-utilities",level:3},{value:"View Functions",id:"view-functions",level:3},{value:"Error Handling",id:"error-handling",level:3},{value:"Event Logging",id:"event-logging",level:3},{value:"Security Features",id:"security-features",level:3},{value:"Dependencies",id:"dependencies",level:3},{value:"Upgradeability",id:"upgradeability",level:3},{value:"Important Considerations",id:"important-considerations",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"contract-modules",children:"Contract Modules"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"ERC20CollateralPool.sol"}),": Main contract."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"ERC20CollateralPool.interface.sol"}),": Interface for contract structures and events."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"ERC20CollateralPool.storage.sol"}),": Storage contract for state management."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"AggregatorV3Interface.sol"}),": Interface for Chainlink price feeds."]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"key-components",children:"Key Components"}),"\n",(0,o.jsx)(n.h3,{id:"constants",children:"Constants"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"LIQUIDATION_PROTOCOL_FEE"}),": A fixed fee charged by the contract during liquidation."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"LIQUIDATION_FEE"}),": A fee awarded to the liquidator as an incentive for carrying out liquidations."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"LIQUIDATION_MARGIN_FACTOR"}),": Factor that determines whether the position is liquidatable."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"MAX_LTV_PERCENTAGE"}),": The highest ",(0,o.jsx)(n.a,{href:"/docs/resources/glossary#loan-to-value-ltv-ratio-also-called-collateral-token-percentage",children:"loan-to-value (LTV) ratio"})," that can be set for a pool."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ONE_YEAR"}),": One year in seconds."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"BPS_DIVIDER"}),": Basis point divider."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"initialization",children:"Initialization"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"__ERC20CollateralPool_init"}),": Initialize the contract with admin, USDC token, and pools."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"pool-management",children:"Pool Management"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"addPool"}),": Add a new pool."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"announceEditPool"}),": Announce upcoming pool edits."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"commitEditPool"}),": Commit announced pool edits."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"cancelEditPool"}),": Cancel announced pool edits."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"contract-control",children:"Contract Control"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"pause"})," / ",(0,o.jsx)(n.code,{children:"unpause"}),": Pause or unpause contract operations."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"withdrawProtocolRewards"}),": Allows admin to withdraw protocol fees."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"user-interactions",children:"User Interactions"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"lend"}),": Supply USDC to a pool."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"borrow"}),": Borrow USDC against collateral."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"repay"}),": Repay borrowed USDC with interest."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"claim"}),": Withdraw supplied USDC with rewards."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"changeCollateralAmount"}),": Change the collateral amount of a borrow position."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"liquidate"}),": Liquidate borrow positions that are liquidatable."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"claimCollateral"}),": Allow to withdraw supply positions, receiving their rewards in collateral tokens by liquidate borrow positions."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"calculation-utilities",children:"Calculation Utilities"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"calculateRepayInterest"}),": Calculate repayment interest."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"calculateCollateralTokenAmount"}),": Calculate required collateral token amount."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"isPositionLiquidatable"}),": Calculate is a borrow position is liquidatable."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"view-functions",children:"View Functions"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"getPools"}),": Get details of all pools."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"getPool"}),": Get details of one pool."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"getLendPosition"}),": Get details of one supply."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"getAllLendPositions"}),": Get all user supply position in the given pool."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"getBorrowPosition"}),": Get details of one borrow."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"getAllBorrowPositions"}),": Get all user borrow position in the given pool."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"getCollateralTokens"}),": Get the list of all collateral tokens."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"getCollateralTokenProtocolFee"}),": Get protocol fees for collateral token."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"getAvailableAmountsInPool"}),": Get available USDC and collateral token amount in a given pool."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,o.jsxs)(n.p,{children:["Defined errors for exceptional scenarios, like ",(0,o.jsx)(n.code,{children:"PoolEndsAtIsInThePast"})," and ",(0,o.jsx)(n.code,{children:"AdminMustNotBeZeroAddress"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"event-logging",children:"Event Logging"}),"\n",(0,o.jsxs)(n.p,{children:["Events like ",(0,o.jsx)(n.code,{children:"newLend"}),", ",(0,o.jsx)(n.code,{children:"newBorrow"}),", ",(0,o.jsx)(n.code,{children:"Repaid"}),", ",(0,o.jsx)(n.code,{children:"RewardsClaimed"}),", ",(0,o.jsx)(n.code,{children:"AddedCollateral"}),", ",(0,o.jsx)(n.code,{children:"RemovedCollateral"}),", and ",(0,o.jsx)(n.code,{children:"UserPositionLiquidated"})," for activity tracking."]}),"\n",(0,o.jsx)(n.h3,{id:"security-features",children:"Security Features"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Pausable"}),": Stop activities in emergencies."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Access Control"}),": Restricted functions for specific roles."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Chainlink Integration"}),": For accurate price information."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"dependencies",children:"Dependencies"}),"\n",(0,o.jsxs)(n.p,{children:["Uses OpenZeppelin's ",(0,o.jsx)(n.code,{children:"SafeERC20Upgradeable"}),", ",(0,o.jsx)(n.code,{children:"AccessControlUpgradeable"}),", ",(0,o.jsx)(n.code,{children:"PausableUpgradeable"}),", and math utilities."]}),"\n",(0,o.jsx)(n.h3,{id:"upgradeability",children:"Upgradeability"}),"\n",(0,o.jsx)(n.p,{children:"Designed with OpenZeppelin's upgradeable contracts framework."}),"\n",(0,o.jsx)(n.h3,{id:"important-considerations",children:"Important Considerations"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Precision and Rounding"}),": While mathematical calculations are handled accurately, slight discrepancies may arise due to rounding and the use of different timestamps for calculating suppliers' and borrowers' rewards."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Time Dependencies"}),": Time-sensitive functions need careful handling."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Security"}),": Regular audits and reviews are recommended."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,l)=>{l.d(n,{R:()=>s,x:()=>c});var i=l(6540);const o={},t=i.createContext(o);function s(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);