"use strict";(self.webpackChunkdocus=self.webpackChunkdocus||[]).push([[605],{6819:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>a});var o=n(5893),l=n(1151);const s={id:"smart-contract-erc20-collateral-pool-example",title:"Example",sidebar_position:3,tags:["Borrow","Lend"]},i=void 0,r={id:"smart-contracts/Pools/smart-contract-erc20-collateral-pool-example",title:"Example",description:"In-depth Actions",source:"@site/docs/smart-contracts/Pools/example.md",sourceDirName:"smart-contracts/Pools",slug:"/smart-contracts/Pools/smart-contract-erc20-collateral-pool-example",permalink:"/documentation/docs/smart-contracts/Pools/smart-contract-erc20-collateral-pool-example",draft:!1,unlisted:!1,editUrl:"https://github.com/defactor-com/documentation/tree/main/docs/smart-contracts/Pools/example.md",tags:[{label:"Borrow",permalink:"/documentation/docs/tags/borrow"},{label:"Lend",permalink:"/documentation/docs/tags/lend"}],version:"current",sidebarPosition:3,frontMatter:{id:"smart-contract-erc20-collateral-pool-example",title:"Example",sidebar_position:3,tags:["Borrow","Lend"]},sidebar:"docSidebar",previous:{title:"Technical Aspects",permalink:"/documentation/docs/smart-contracts/Pools/smart-contract-erc20-collateral-pool-technical-aspects"}},c={},a=[{value:"In-depth Actions",id:"in-depth-actions",level:2},{value:"Event #1 (contract initialization)",id:"event-1-contract-initialization",level:3},{value:"Event #2 (create a pool)",id:"event-2-create-a-pool",level:3},{value:"Event #3 (commit to a pool)",id:"event-3-commit-to-a-pool",level:3},{value:"Event #4 (collect from pool)",id:"event-4-collect-from-pool",level:3},{value:"Event #5 (deposit rewards)",id:"event-5-deposit-rewards",level:3},{value:"Event #6 (claim rewards)",id:"event-6-claim-rewards",level:3},{value:"Event #7 (close pool)",id:"event-7-close-pool",level:3}];function d(e){const t={code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"in-depth-actions",children:"In-depth Actions"}),"\n",(0,o.jsxs)(t.p,{children:["The flow starts when the borrower creates a new pool setting as collateral one or multiple assets that follows the ",(0,o.jsx)(t.code,{children:"ERC20"}),", ",(0,o.jsx)(t.code,{children:"ERC721"})," or ",(0,o.jsx)(t.code,{children:"ERC1155"})," standards, once the pool is created and the collateral has been successfully transferred from the borrower's wallet to the contract, then the pool will be marked as ",(0,o.jsx)(t.code,{children:"CREATED"})," that means it is ready to start receiving funds from the investors. The pool was configured initially with a soft and hard cap, when the total amount committed to the pool reaches at least the soft cap the borrower (pool owner) can decide whether to collect the funds or wait until the hard cap is reached. After the owner collected the raised capital, no new commits or un-commit are allowed to the pool this is because the borrower has already took the funds and the investors will need to wait until the rewards start coming in."]}),"\n",(0,o.jsx)(t.p,{children:"As long as the pool is active, the borrower can deposit the rewards in any frequency they want the only to allow the investors to claim their rewards."}),"\n",(0,o.jsx)(t.p,{children:"Once the pool owner completes their goal by creating the pool and decides to close it, the investors will have to claim their reward in the following 60 days because later the pool can be archived and therefore no other action will be allowed. Any leftover reward will be will be accredited to the contract as a fee collected."}),"\n",(0,o.jsx)(t.p,{children:"Lets consider the following example to better understand how this flow works:"}),"\n",(0,o.jsxs)(t.p,{children:["Event #1 -> ",(0,o.jsx)(t.em,{children:"The contract is initialized with the USDC address that will be used for lending money"}),".\nEvent #2 -> Bob creates a new pool with a soft cap of 1000 USDC and a hard cap of 2000 USDC, using 100 tokens of GOLD as collateral.\nEvent #3 -> Alice commits 1100 USDC to the pool.\nEvent #4 -> Bob collects the funds from the pool.\nEvent #5 -> After 30 days, Bob deposits 1100 USDC as rewards into the pool.\nEvent #6 -> After 60 days, Alice claims 1100 USDC as rewards from the pool.\nEvent #7 -> Bob closes the pool."]}),"\n",(0,o.jsx)(t.p,{children:"Let's break down what is under the hood of each event:"}),"\n",(0,o.jsx)(t.h3,{id:"event-1-contract-initialization",children:"Event #1 (contract initialization)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"The contract is initialized with the USDC address that will be used for lending money, and the initializer will be the admin of the contract."}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"event-2-create-a-pool",children:"Event #2 (create a pool)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Anyone can create a pool; the contract only requests a fee of 200 USDC, so Bob must have at least 200 USDC tokens."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"The pool will be created with a soft cap of 1000 USDC and a hard cap of 2000 USDC."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"A pool instance is created with the collateral tokens provided by Bob."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"The pool status will be marked with the status CREATED."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Transfer Bob's GOLD collateral tokens from his wallet to the contract."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Emit the event PoolCreated."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"event-3-commit-to-a-pool",children:"Event #3 (commit to a pool)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["The commits to the pool can happen only when the pool status is ",(0,o.jsx)(t.code,{children:"CREATED"})," and the pool has not reached the hard cap."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"1100 USDC is committed to the pool total committed amount."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Add the 1100 USDC to the commits that Alice has made to the pool."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Make the transfer of 1100 USDC from Alice's wallet to the contract."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Emit the event ",(0,o.jsx)(t.code,{children:"CommittedToPool"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"event-4-collect-from-pool",children:"Event #4 (collect from pool)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"This can only be done by the pool owner, for this example, it would be Bob."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Since bob's pool has already reached the soft cap of 1000 USDC, Bob is allowed to collect the pool."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"The contract will charge a 2% fee on the total amount committed to the pool, in this case, 22 USDC."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"This fee amount is then added to the contract's collected fee."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["The pool status will be marked with the status ",(0,o.jsx)(t.code,{children:"ACTIVE"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Make the transfer of ",(0,o.jsx)(t.code,{children:"total commited to pool - 2% contract fee"})," USDC from the contract to Alice's wallet."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Emit the event ",(0,o.jsx)(t.code,{children:"PoolCollected"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"event-5-deposit-rewards",children:"Event #5 (deposit rewards)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"This can only be done by the pool owner, in this case, it would be Bob."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"The amount of 1100 USDC is deposited to the pool as rewards."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Make the transfer of 1100 USDC from Bob's wallet to the contract."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Emit the event ",(0,o.jsx)(t.code,{children:"RewardsDeposited"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"event-6-claim-rewards",children:"Event #6 (claim rewards)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["This can only be done when the pool status is ",(0,o.jsx)(t.code,{children:"CLOSED"})," or ",(0,o.jsx)(t.code,{children:"ACTIVE"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Alice can now claim the total rewards as she was the only one who committed to the pool."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"The rewards are calculated as follows:"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-solidity",children:"((pool.totalRewards * poolCommit.amount) / pool.totalCommitted) - poolCommit.claimedAmount\n"})}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"The rewards are then added to the Alice's total claimed amount and then added to the rewards paid out by the pool."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Make the transfer of ",(0,o.jsx)(t.code,{children:"total rewards"})," USDC from the contract to Alice's wallet."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Emit the event ",(0,o.jsx)(t.code,{children:"RewardsClaimed"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"event-7-close-pool",children:"Event #7 (close pool)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"This can only be done by the pool owner, in this case, it would be Bob."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["The pool status will be marked with the status ",(0,o.jsx)(t.code,{children:"CLOSED"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Return the pool owner's collateral tokens from the contract to Bob's wallet."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Emit the event ",(0,o.jsx)(t.code,{children:"PoolClosed"}),"."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,l.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>r,a:()=>i});var o=n(7294);const l={},s=o.createContext(l);function i(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);